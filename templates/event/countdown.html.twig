{% extends 'base.html.twig' %}


{% block title %}Compte à Rebours des Événements{% endblock %}

{% block body %}
<style>
    .urgent-event {
        position: relative;
        z-index: 1;
      }
      
      .urgent-event::before {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border-radius: 15px;
        background: rgba(243, 85, 37, 0.15); /* Softer orange glow */
        z-index: -1;
        animation: pulse-glow 2.5s ease-in-out infinite;
        box-shadow: 0 0 10px rgba(243, 85, 37, 0.2); /* Subtle glow */
      }
      
      @keyframes pulse-glow {
        0% {
          opacity: 0.3;
          transform: scale(0.98);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.01);
        }
        100% {
          opacity: 0.3;
          transform: scale(0.98);
        }
      }
      
      .urgent-event .card {
        border: 2px solid #f35525;
        background: #fffaf7;
        border-radius: 15px;
        transition: box-shadow 0.3s;
      }
    .btn-reserver {
        background-color: #f35525; /* même orange que .orange-button */
        color: #fff;
        font-weight: 600;
        border: none;
        border-radius: 30px;
        padding: 12px 24px;
        display: inline-block;
        transition: all 0.3s ease-in-out;
        text-align: center;
        text-transform: uppercase;
        font-size: 0.95rem;
      }
      
      .btn-reserver:hover {
        background-color: #e04e1d;
        box-shadow: 0 4px 15px rgba(243, 85, 37, 0.3);
        transform: translateY(-2px);
      }
    </style>
<div class="container mt-5">
    <h2 class="mb-4 text-center">🕒 Prochains événements à ne pas rater!</h2>

    <div class="row">
        {% for event in events %}
    <div class="col-md-6 mb-4 countdown-container">
        <div class="card p-3 shadow-sm">
            <img 
                src="{{ asset('uploads/' ~ event.image) }}" 
                alt="{{ event.nomEvent }}" 
                class="img-fluid rounded mb-3" 
                style="height: 200px; object-fit: cover;"
            >
            <h4>{{ event.nomEvent }}</h4>
            <p class="text-muted mb-1">📅 Le {{ event.date }}</p>
            <p class="text-muted">📍 {{ event.nomEspace }} | 🎟️ {{ event.prix }} DT</p>
            <div class="countdown text-primary fw-bold fs-5" id="countdown-{{ loop.index }}"></div>

            <a href="{{ path('app_billet_reservation', {'id': event.idEvent}) }}" class="btn-reserver mt-3 w-100 text-center d-block">
                🎟️ Réserver
            </a>

            <script>
                (function () {
                    const container = document.currentScript.closest('.countdown-container');
                    const countdownEl = document.getElementById('countdown-{{ loop.index }}');
                    const eventDate = new Date("{{ event.date|trim }}T00:00:00");

                    if (isNaN(eventDate.getTime())) {
                        container.style.display = "none";
                    } else {
                        const interval = setInterval(() => {
                            const now = new Date().getTime();
                            const diff = eventDate.getTime() - now;
                            if (diff <= 86400000) { // moins de 24h (1000 * 60 * 60 * 24)
                                container.classList.add('urgent-event');
                                const badge = document.createElement('span');
                                badge.className = 'badge bg-danger text-white position-absolute top-0 end-0 m-2';
                                badge.textContent = '🔥 URGENT';
                                container.querySelector('.card').appendChild(badge);
                            }
                            

                            if (diff <= 0) {
                                countdownEl.innerHTML = "🚀 L'événement a commencé !";
                                countdownEl.classList.remove('text-primary');
                                countdownEl.classList.add('text-success');
                                clearInterval(interval);
                                return;
                            }

                            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                            countdownEl.innerHTML = `${days}j ${hours}h ${minutes}m ${seconds}s`;
                        }, 1000);
                    }
                })();
            </script>
        </div>
    </div>
{% else %}
    <div class="col-12">
        <p class="text-center text-muted">Aucun événement à venir trouvé.</p>
    </div>
{% endfor %}

    </div>
</div>
{% endblock %}
