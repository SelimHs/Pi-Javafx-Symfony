{% extends 'baseBack.html.twig' %}

{% block title %}Liste des R√©servations{% endblock %}

{% block body %}
<div class="app-main__outer">
  <div class="app-main__inner">

    <div class="app-page-title">
      <div class="page-title-wrapper">
        <div class="page-title-heading">
          <div class="page-title-icon">
            <i class="pe-7s-note2 icon-gradient bg-mean-fruit"></i>
          </div>
          <div>
            Gestion des R√©servations
            <div class="page-title-subheading">Visualisez et g√©rez les r√©servations enregistr√©es.</div>
          </div>
        </div>
        <div class="page-title-actions">
          <a href="{{ path('app_reservation_new') }}" class="btn btn-success">
            <i class="pe-7s-plus"></i> Nouvelle R√©servation
          </a>
        </div>
      </div>
    </div>

    <!-- üî• New Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card mb-3 widget-content bg-midnight-bloom">
          <div class="widget-content-wrapper text-white">
            <div class="widget-content-left">
              <div class="widget-heading">Total R√©servations</div>
              <div class="widget-subheading">Nombre total</div>
            </div>
            <div class="widget-content-right">
              <div class="widget-numbers text-white"><span>{{ totalReservations }}</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card mb-3 widget-content bg-arielle-smile">
          <div class="widget-content-wrapper text-white">
            <div class="widget-content-left">
              <div class="widget-heading">Confirm√©es</div>
              <div class="widget-subheading">R√©servations confirm√©es</div>
            </div>
            <div class="widget-content-right">
              <div class="widget-numbers text-white"><span>{{ totalConfirmees }}</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card mb-3 widget-content bg-grow-early">
          <div class="widget-content-wrapper text-white">
            <div class="widget-content-left">
              <div class="widget-heading">Annul√©es</div>
              <div class="widget-subheading">R√©servations Annul√©es</div>
            </div>
            <div class="widget-content-right">
              <div class="widget-numbers text-white"><span>{{ totalAnnulee }}</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- üî• End New Statistics -->

    <form action="{{ path('app_reservation_valider_billets') }}" method="post" onsubmit="return confirm('Confirmer tous les billets en attente ?');">
      <button class="btn btn-outline-warning me-2" type="submit">
        ‚úÖ Valider les billets en attente
      </button>
    </form>
    
    

    <div class="main-card mb-3 card">
      <div class="card-header">
        <div class="row w-100 align-items-center">
          <div class="col-md-6">
            <h5 class="mb-0">R√©servations enregistr√©es</h5>
          </div>
          <div class="col-md-6 d-flex justify-content-end gap-3 flex-wrap mt-2 mt-md-0">
            <input type="text" id="searchReservation" class="form-control form-control-sm" placeholder="üîç Rechercher" style="width: 180px;">
            <select id="statutFilter" class="form-select form-select-sm" style="width: 180px;">
              <option value="">-- Tous les statuts --</option>
              <option value="confirm√©e">Confirm√©e</option>
              <option value="en attente">En attente</option>
              <option value="annul√©e">Annul√©e</option>
            </select>
            <a href="{{ path('export_reservations_excel') }}" class="btn btn-sm btn-outline-primary">
              üì• Exporter en Excel
            </a>
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="align-middle mb-0 table table-striped table-hover">
          <thead>
            <tr>
              <th class="text-center">#</th>
              <th>Date de R√©servation</th>
              <th>Statut</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for reservation in reservations %}
              <tr>
                <td class="text-center text-muted">#{{ reservation.idReservation }}</td>
                <td>{{ reservation.dateReservation ? reservation.dateReservation|date('Y-m-d H:i') : '‚Äî' }}</td>
                <td>
                  {% if reservation.statut == 'confirm√©e' %}
                    <span class="badge badge-success">Confirm√©e</span>
                  {% elseif reservation.statut == 'annul√©e' %}
                    <span class="badge badge-danger">Annul√©e</span>
                  {% else %}
                    <span class="badge badge-warning">{{ reservation.statut }}</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <a href="{{ path('app_reservation_show', {'idReservation': reservation.idReservation}) }}" class="btn btn-sm btn-info">
                    <i class="fas fa-eye"></i> D√©tails
                  </a>
                  <a href="{{ path('app_reservation_edit', {'idReservation': reservation.idReservation}) }}" class="btn btn-sm btn-warning">
                    <i class="fas fa-edit"></i> Modifier
                  </a>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="4" class="text-center text-muted">Aucune r√©servation trouv√©e.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const filterSelect = document.getElementById('statutFilter');
    const searchInput = document.getElementById('searchReservation');
    const rows = document.querySelectorAll('table tbody tr');

    function filterRows() {
      const selectedStatut = filterSelect.value.toLowerCase();
      const searchValue = searchInput.value.trim().toLowerCase();

      rows.forEach(row => {
        const cellsText = row.innerText.toLowerCase();
        const matchesSearch = !searchValue || cellsText.includes(searchValue);
        const matchesStatut = !selectedStatut || cellsText.includes(selectedStatut);

        row.style.display = (matchesSearch && matchesStatut) ? '' : 'none';
      });
    }

    filterSelect.addEventListener('change', filterRows);
    searchInput.addEventListener('input', filterRows);
  });
</script>
{% endblock %}
